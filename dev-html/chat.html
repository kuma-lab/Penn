<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../dev-css/chat.css" />
    <link rel="stylesheet" href="../assets/css/chat.css" />
    <title>chat Page</title>
</head>
<body>
    <!-- Header site -->
    <header class="headerSite">
    <a href="home.html" class="linkToHome">
        <img class="logo" src="../assets/img/logo.png" alt="">
    </a>
    <!-- <div class="searchContainer">
        <img src="../assets/img/Search.png" alt="search" class="searchIcon">
        <label class="labelSearch" for="gsearch"></label>
        <input type="search" class="searchInput" id="gsearch" placeholder="search people" name="gsearch">
    </div> -->
    <!-- <div class="imgContainer notification">
        <img src="../assets/img/Notification 1.png" alt="notification" class="notificationIcon">
    </div> -->
    <div class="imgContainer avatar">
        <img src="../assets/img/avatar2.png" alt="avatar" class="avatarImage">
    </div>
    </header>

    <main class="mainWrapper">
        <article class="peopleChat">
            <section class="connectionsBlock">
                <h2 class="titleBlock">Discussion</h2>
                <div class="messagesList">
                  <div class="messageContainer unread">
                    <div class="avatarContainer">
                      <img class="avatar" src="../assets/img/avatar1.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                      <h4 class="name">Alexandra Heyman</h4>
                      <p class="titleField">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga tempora quam quasi neque suscipit magnam in porro dolore omnis. Veniam corporis ipsa soluta porro modi assumenda doloribus optio neque expedita.</p>
                    </div>
                    <div>
                      <img src="../assets/img/messages.png" class="iconMsg" alt="messages">
                    </div>
                  </div>
                  <div class="messageContainer unread">
                    <div class="avatarContainer">
                      <img class="avatar" src="../assets/img/avatar2.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                      <h4 class="name">Alexandra Heyman</h4>
                      <p class="titleField">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga tempora quam quasi neque suscipit magnam in porro dolore omnis. Veniam corporis ipsa soluta porro modi assumenda doloribus optio neque expedita.</p>
                    </div>
                    <img src="../assets/img/messages.png" class="iconMsg" alt="messages">
                  </div>
                  <div class="messageContainer active">
                    <div class="avatarContainer">
                      <img class="avatar" src="../assets/img/avatar5.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                      <h4 class="name">Alexandra Heyman</h4>
                      <p class="titleField">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga tempora quam quasi neque suscipit magnam in porro dolore omnis. Veniam corporis ipsa soluta porro modi assumenda doloribus optio neque expedita.</p>
                    </div>
                    <img src="../assets/img/messages.png" class="iconMsg" alt="messages">
                  </div>
                  <div class="messageContainer">
                    <div class="avatarContainer">
                      <img class="avatar" src="../assets/img/avatar4.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                      <h4 class="name">Alexandra Heyman</h4>
                      <p class="titleField">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga tempora quam quasi neque suscipit magnam in porro dolore omnis. Veniam corporis ipsa soluta porro modi assumenda doloribus optio neque expedita.</p>
                    </div>
                    <img src="../assets/img/messages.png" class="iconMsg" alt="messages">
                  </div>
                  <div class="messageContainer">
                    <div class="avatarContainer">
                      <img class="avatar" src="../assets/img/avatar3.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                      <h4 class="name">Alexandra Heyman</h4>
                      <p class="titleField">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga tempora quam quasi neque suscipit magnam in porro dolore omnis. Veniam corporis ipsa soluta porro modi assumenda doloribus optio neque expedita.</p>
                    </div>
                    <img src="../assets/img/messages.png" class="iconMsg" alt="messages">
                  </div>
                  <div class="messageContainer">
                    <div class="avatarContainer">
                      <img class="avatar" src="../assets/img/avatar6.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                      <h4 class="name">Alexandra Heyman</h4>
                      <p class="titleField">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga tempora quam quasi neque suscipit magnam in porro dolore omnis. Veniam corporis ipsa soluta porro modi assumenda doloribus optio neque expedita.</p>
                    </div>
                    <img src="../assets/img/messages.png" class="iconMsg" alt="messages">
                  </div>
                  <div class="messageContainer">
                    <div class="avatarContainer">
                      <img class="avatar" src="../assets/img/avatar7.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                      <h4 class="name">Alexandra Heyman</h4>
                      <p class="titleField">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga tempora quam quasi neque suscipit magnam in porro dolore omnis. Veniam corporis ipsa soluta porro modi assumenda doloribus optio neque expedita.</p>
                    </div>
                    <img src="../assets/img/messages.png" class="iconMsg" alt="messages">
                  </div>
                  <div class="messageContainer">
                    <div class="avatarContainer">
                      <img class="avatar" src="../assets/img/avatar8.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                      <h4 class="name">Alexandra Heyman</h4>
                      <p class="titleField">Lorem ipsum dolor sit amet consectetur adipisicing elit. Fuga tempora quam quasi neque suscipit magnam in porro dolore omnis. Veniam corporis ipsa soluta porro modi assumenda doloribus optio neque expedita.</p>
                    </div>
                    <img src="../assets/img/messages.png" class="iconMsg" alt="messages">
                  </div>
                </div>
              </section>
        </article>

        <article class="commWrapper">
            <section class="messageContainer">
                <div class="personContainer">
                    <div class="avatarContainer">
                        <img class="avatar" src="../assets/img/avatar5.png" alt="avatar">
                    </div>
                    <div class="txtInfos">
                        <h4 class="name">Alexandra Heyman</h4>
                        <p class="titleField">Computer Science</p>
                        <p class="titleField">Alexandra Heyman Nash Peen Integrates Knowledge</p>
                    </div>
                </div>
                <div class="messagesLayout">
                    <p class="message send">
                        Hello how are you today?
                    </p>
                    <p class="message receive">
                        So tired after chirstams Eve. However i canâ€™t wait to go back to work
                    </p>
                    <div class="iframeContainer message send">
                        <div class="iframe" style="background-image: url(https://sil.asc.upenn.edu/exchange/thumbnails/11/1187.jpg);"></div>
                </div>
            </section>

            <section class="keyboardContainer">
                <img src="../assets/img/smile.png" alt="emoji">
                <input class="keyboard" type="text" placeholder="Type your message...">
                <img class="clip" src="../assets/img/clip.png" alt="clip">
                <img class="sendBtn" src="../assets/img/send.png" alt="send">
            </section>
        </article>
    </main>

    <script type="text/javascript">
    
      /**************************
      /* Send Message
      ***************************/
      let messages = document.querySelector('.messagesLayout')
      const sendBtn = document.querySelector('.sendBtn')
      const sendInput = document.querySelector('.keyboard')

      // Get Current Date
      function getCurrentDate() {
        let today = new Date()
        const dd = String(today.getDate()).padStart(2, '0')
        const mm = String(today.getMonth() + 1).padStart(2, '0') //January is 0!
        const yyyy = today.getFullYear()

        today = mm + '/' + dd + '/' + yyyy
        return today
      }

      // Button/Enter Key
      sendBtn.addEventListener('click', sendMessage)
      sendInput.addEventListener('keyup', function(e) { 
        if(e.keyCode == 13) sendMessage() 
      })

      // Messenger Functions
      function sendMessage() {
        let message = sendInput.value
        sendInput.value = ''
        // skip blank messages
        if(message.length < 1) {
          sendInput.placeholder = "Minimum length is 1 character!"
        } else {
          sendInput.placeholder = "Type your message..."
          let lastMessageId = document.querySelector('.messagesLayout').lastChild.getAttribute('data-id-message')
          // @todo : send new message to server with fetch POST
          writeLine(message, true, getCurrentDate(), lastMessageId++)
        }
      }

      function writeLine(text, sent, date, id) {
        const idExist = document.querySelector('[data-id-message="' + id+ '"]')
        // If message doesn't exist, we create it 
        if(!idExist) {
          let message = document.createElement('P')
          message.dataset.idMessage = id
          sent ? message.classList.add('message', 'send') : message.classList.add('message', 'receive')
          message.innerHTML = text
          messages.appendChild(message)
          messages.scrollTop = messages.scrollHeight
        }
      }

      /**************************
      /* Refresh messages
      ***************************/

      function refreshMessages() {
        fetch('http://sil.asc.upenn.edu/exchange/chat/22',{
          method: "GET"}).then(function (response) {
          // The API call was successful!
          return response.json()
        }).then(function (data) {
          // This is the JSON from our response
          Object.entries(data).forEach(([key, value]) => {
            writeLine(value.content, value.sent, value.date, value.id)
          })
        }).catch(function (err) {
          // There was an error
          console.warn('Something went wrong.', err)
        })
      }

      const intervalRefresh = setInterval(refreshMessages, 5000)
    </script>

</body>
</html>